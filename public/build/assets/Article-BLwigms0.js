import{s as p,u as f,i as b,e as d,v as o}from"./app-CyMA9q_N.js";var a=[];for(var u=0;u<256;++u)a.push((u+256).toString(16).slice(1));function g(i,t=0){return(a[i[t+0]]+a[i[t+1]]+a[i[t+2]]+a[i[t+3]]+"-"+a[i[t+4]]+a[i[t+5]]+"-"+a[i[t+6]]+a[i[t+7]]+"-"+a[i[t+8]]+a[i[t+9]]+"-"+a[i[t+10]]+a[i[t+11]]+a[i[t+12]]+a[i[t+13]]+a[i[t+14]]+a[i[t+15]]).toLowerCase()}var s,m=new Uint8Array(16);function y(){if(!s&&(s=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!s))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(m)}var v=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const h={randomUUID:v};function n(i,t,e){if(h.randomUUID&&!t&&!i)return h.randomUUID();i=i||{};var r=i.random||(i.rng||y)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){e=e||0;for(var l=0;l<16;++l)t[e+l]=r[l];return t}return g(r)}const D=p("Article",{state:()=>({users_id:[],model:{id:n,date:new Date().toISOString().substr(0,10),description:"",price:null,is_private:!1,star:!1,product_id:null},models:[{id:n(),date:new Date().toISOString().substr(0,10),description:"",price:null,is_private:!1,star:!1,product_id:null}],article_filter:["0","3"],dashboard:f(),auth:b()}),actions:{deleteModel:function(i){this.models=this.models.filter(t=>t.id!=i)},deleteArticle:async function(i){await d.delete(`/api/articles/${i}`).then(t=>(this.dashboard.articles=this.dashboard.articles.filter(e=>e.id!=i),t))},postArticles:async function(){return this.models.forEach(i=>i.date=o(i.date).format("YYYY-MM-DD")),await d.post("/api/articles",{articles:this.models}).then(i=>(this.models=[{id:n(),date:new Date().toISOString().substr(0,10),description:"",price:null,is_private:!1,star:!1,product_id:null}],i)).catch(i=>{console.log("error",i)})},getArticle:async function(i){return this.dashboard.fetching=!0,await d.get(`/api/articles/${i}`).then(t=>(this.dashboard.fetching=!1,t.data.article))},updateArticle:async function(i){i.date=o(i.date).format("YYYY-MM-DD"),await d.patch(`/api/articles/${i.id}`,{article:i,update_bill:!!i.bill_id}).then(t=>{let e=this.dashboard.articles.find(r=>r.id==i.id);e&&(e.date=t.data.article.date,e.name=t.data.article.name,e.description=t.data.article.description,e.price=t.data.article.price,e.is_private=t.data.article.is_private,e.star=t.data.article.star,e.product_id=t.data.article.product_id)})},cancelBill:async function(i){await d.patch(`/api/articles/${i.id}`,{article:{bill_id:null},update_bill:!0}).then(t=>{let e=this.dashboard.articles.find(r=>r.id==i.id);e&&(e.bill_id=t.data.article.bill_id,e.users_id=[])})},makeBill:async function(){return await d.post("/api/bills",{articles:this.getBillQueue.map(i=>i.id),users_id:this.users_id}).then(i=>{var t,e;return this.getBillQueue.forEach(r=>{let l=this.dashboard.articles.find(c=>c.id==r.id);l.bill_id=i.data.bill.id}),(e=(t=i.data.bill)==null?void 0:t.articles)==null||e.forEach(r=>{let l=this.dashboard.articles.find(c=>c.id==_bill_article.id);l.user_id=r.user_id}),this.dashboard.bills_dates.push(i.data.bill.date),i.data.bill}).catch(i=>!0)},toggleBill:function(i){let t=this.dashboard.articles.find(e=>e.id==i);t&&(t.bill_id=!t.bill_id)},toggleBills:function(i){this.articles.filter(t=>typeof t.bill_id=="object"||typeof t.bill_id=="boolean").forEach(t=>t.bill_id=!i)},resetBillPlanning:function(){this.getBillQueue.map(i=>i.bill_id=!1)},addArticle:function(){this.models.push({id:n(),date:new Date().toISOString().substr(0,10),description:"",price:null,is_private:!1,star:!1,product_id:null})}},getters:{articles:i=>{let t=[];return i.article_filter.find(e=>e=="0")&&t.push(...i.regular_articles.filter(e=>i.auth.getAuth.id==e.user_id)),i.article_filter.find(e=>e=="1")&&t.push(...i.regular_articles.filter(e=>!e.is_private&&e.user_id!=i.auth.getAuth.id)),i.article_filter.find(e=>e=="2")&&(t=t.filter(e=>e.bill_id)),i.article_filter.find(e=>e=="3")?t=t.filter(e=>!e.is_private):t=t.filter(e=>e.is_private),_.orderBy(t,["star","date"],["asc","desc"])},total_articles:i=>_.sumBy(i.articles,"price"),total_articles_selected:i=>_.sumBy(i.getBillQueue,"price"),getBillQueue:i=>i.regular_articles.filter(t=>t.bill_id===!0),regular_articles:i=>i.dashboard.articles.filter(t=>t.user_id==i.auth.getAuth.id||t.user_id!=i.auth.getAuth.id&&!t.is_private)}});export{D as u};
