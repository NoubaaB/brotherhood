import{v as b,d as o,u as f,i as g,e as d,x as p}from"./app-BNh_k1dH.js";var a=[];for(var u=0;u<256;++u)a.push((u+256).toString(16).slice(1));function m(t,i=0){return(a[t[i+0]]+a[t[i+1]]+a[t[i+2]]+a[t[i+3]]+"-"+a[t[i+4]]+a[t[i+5]]+"-"+a[t[i+6]]+a[t[i+7]]+"-"+a[t[i+8]]+a[t[i+9]]+"-"+a[t[i+10]]+a[t[i+11]]+a[t[i+12]]+a[t[i+13]]+a[t[i+14]]+a[t[i+15]]).toLowerCase()}var s,y=new Uint8Array(16);function v(){if(!s&&(s=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!s))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(y)}var w=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const h={randomUUID:w};function n(t,i,e){if(h.randomUUID&&!i&&!t)return h.randomUUID();t=t||{};var r=t.random||(t.rng||v)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,i){e=e||0;for(var l=0;l<16;++l)i[e+l]=r[l];return i}return m(r)}const B=b("Article",{state:()=>({overlay_text:"",overlay_color:"",overlay_src:"",overlay_record:!1,users_id:o().users.map(t=>t.id),filter_users_id:o().users.map(t=>t.id),model:{id:n,date:new Date().toISOString().substr(0,10),description:"",price:null,is_private:!1,star:!1,product_id:null},models:[{id:n(),date:new Date().toISOString().substr(0,10),description:"",price:null,is_private:!1,star:!1,product_id:null}],article_filter:["0","3"],dashboard:f(),auth:g()}),actions:{deleteModel:function(t){this.models=this.models.filter(i=>i.id!=t)},deleteArticle:async function(t){await d.delete(`/api/articles/${t}`).then(i=>(this.dashboard.articles=this.dashboard.articles.filter(e=>e.id!=t),i))},postArticles:async function(){return this.models.forEach(t=>t.date=p(t.date).format("YYYY-MM-DD")),await d.post("/api/articles",{articles:this.models}).then(t=>(this.models=[{id:n(),date:new Date().toISOString().substr(0,10),description:"",price:null,is_private:!1,star:!1,product_id:null}],t)).catch(t=>{console.log("error",t)})},getArticle:async function(t){return this.dashboard.fetching=!0,await d.get(`/api/articles/${t}`).then(i=>(this.dashboard.fetching=!1,i.data.article))},updateArticle:async function(t){t.date=p(t.date).format("YYYY-MM-DD"),await d.patch(`/api/articles/${t.id}`,{article:t,update_bill:!!t.bill_id}).then(i=>{let e=this.dashboard.articles.find(r=>r.id==t.id);e&&(e.date=i.data.article.date,e.name=i.data.article.name,e.description=i.data.article.description,e.price=i.data.article.price,e.is_private=i.data.article.is_private,e.star=i.data.article.star,e.product_id=i.data.article.product_id)})},cancelBill:async function(t){await d.patch(`/api/articles/${t.id}`,{article:{bill_id:null},update_bill:!0}).then(i=>{let e=this.dashboard.articles.find(r=>r.id==t.id);e&&(e.bill_id=i.data.article.bill_id,e.users_id=[])})},makeBill:async function(){return await d.post("/api/bills",{articles:this.getBillQueue.map(t=>t.id),users_id:this.users_id}).then(t=>{var i,e;return this.getBillQueue.forEach(r=>{let l=this.dashboard.articles.find(c=>c.id==r.id);l.bill_id=t.data.bill.id}),(e=(i=t.data.bill)==null?void 0:i.articles)==null||e.forEach(r=>{let l=this.dashboard.articles.find(c=>c.id==_bill_article.id);l.user_id=r.user_id}),this.dashboard.bills_dates.push(t.data.bill.date),t.data.bill}).catch(t=>!0)},toggleBill:function(t){let i=this.dashboard.articles.find(e=>e.id==t);i&&(i.bill_id=!i.bill_id)},toggleBills:function(t){this.articles.filter(i=>typeof i.bill_id=="object"||typeof i.bill_id=="boolean").forEach(i=>i.bill_id=!t)},resetBillPlanning:function(){this.getBillQueue.map(t=>t.bill_id=!1)},addArticle:function(){this.models.push({id:n(),date:new Date().toISOString().substr(0,10),description:"",price:null,is_private:!1,star:!1,product_id:null})}},getters:{articles:t=>{let i=t.regular_articles;return t.article_filter.find(e=>e=="3")?i=i.filter(e=>!e.is_private):i=i.filter(e=>e.is_private),i=i.filter(e=>t.filter_users_id.includes(e.user_id)),_.orderBy(i,["star","date"],["asc","desc"])},total_articles:t=>_.sumBy(t.articles,"price"),total_articles_selected:t=>_.sumBy(t.getBillQueue,"price"),getBillQueue:t=>t.regular_articles.filter(i=>i.bill_id===!0),regular_articles:t=>t.dashboard.articles.filter(i=>i.user_id==t.auth.getAuth.id||i.user_id!=t.auth.getAuth.id&&!i.is_private)}});export{B as u};
