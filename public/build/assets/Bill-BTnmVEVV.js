import{q as Q,u as R,g as T,s as p,_ as G,d as H,r as o,o as a,e as m,i as r,a as n,w as l,b as d,t as u,c,h as g,F as w,f as C,n as J,p as K,l as P}from"./app-C_eR3KOJ.js";const W=Q("Bill",{state:()=>({date_start:moment().subtract(6,"days").format("YYYY-MM-DD"),date_end:new Date().toISOString().substr(0,10),is_fetch:!1,bill_checked:!1,dashboard:R(),auth:T()}),actions:{getData:async function(){this.is_fetch==!1&&(this.is_fetch=!0,await p.get("/api/bills",{params:{date_start:this.date_start,date_end:this.date_end}}).then(e=>{this.dashboard.bills=_.sortBy(e.data.bills,"date"),this.is_fetch=!1}))},getBill:async function(e){return await p.get(`/api/bills/${e}`).then(t=>t.data.bill)},deleteBill:async function(e){return p.delete(`/api/bills/${e}`).then(t=>(this.dashboard.bills=this.dashboard.bills.filter(s=>s.id!=e),t))},deleteBills:async function(){let e=this.dashboard.bills.filter(t=>t.selected==!0).map(t=>t.id);return p.post("/api/bills_collect",{bills:e}).then(t=>(this.dashboard.bills=this.dashboard.bills.filter(s=>!e.includes(s.id)),t)).catch(t=>{console.log("error",t)})},toggleBill:function(e){let t=this.dashboard.bills.find(s=>s.id==e);t&&(t.selected=!t.selected)},cancelBill:function(){},toggleInvoice:function(e,t){p.put(`/api/invoices/${e}`,{checked:t})},unBillArticle:async function(e,t){return p.patch(`/api/articles/${e}`,{article:{bill_id:null},update_bill:!0}).then(s=>{let b=this.dashboard.bills.find(v=>v.id==t);return b?(b.articles=b.articles.filter(v=>v.id!=e),b.amount=_.sumBy(b.articles,"price"),!1):!0})}},getters:{getBillQueue:e=>e.dashboard.bills.filter(t=>t.selected===!0),total_bills:e=>_.sumBy(e.dashboard.bills,"amount"),total_bills_filtred:e=>_.sumBy(e.bills,"amount"),bills:e=>_.orderBy(e.dashboard.bills.filter(t=>{var s;return((s=t.invoices.find(b=>b.user_id==e.auth.getAuth.id))==null?void 0:s.checked)==e.bill_checked}),["date","id"],["desc","desc"])}}),A={props:{bill:Object},data:function(){return{expand_articles:!1,expand_invoices:!1,loading:!1,loading_bill:!1,on_delete:!1,pause:!1,setTimeout:null,setInterval:null,counter:1,color:"white"}},mounted:function(){this.bill.user_id==this.auth.getAuth.id&&this.$nextTick(()=>{const e="#"+this.bill.id,t=new Swiper(e,{resistanceRatio:.85,initialSlide:0,resistance:!0,allowSlideNext:!1,momentumBounce:!0,speed:150});t.on("transitionStart",()=>{this.on_delete=!0,this.loading=!0,this.setTimeout=setTimeout(()=>{this.deleteBill().then(s=>{t.destroy()})},3e3),this.setInterval=setInterval(()=>{++this.counter},1e3)})})},computed:{_bill:function(){return W()},dashboard:function(){return useDashboard()},auth:function(){return T()},user:function(){return H()}},methods:{deleteBill:async function(){return await this._bill.deleteBill(this.bill.id).then(e=>{this.$route.params.id&&this.$router.push({name:"bills.list"})})},aditBill:function(){this.$router.push({name:"bills.update",params:{id:this.bill.id}})},viewBill:function(){this.$router.push({name:"bills.view",params:{id:this.bill.id}})},cancelBill:async function(){return this.loading_bill=!0,await this._bill.cancelBill(this.bill).then(e=>(this.loading_bill=!1,e))},toggleBill:function(){this._bill.toggleBill(this.bill.id)},unBillArticle:async function(e,t){this.loading_bill=!0,await this._bill.unBillArticle(e,t).then(s=>{this.loading_bill=!1,s&&(this.bill.articles=this.bill.articles.filter(b=>b.id!=e),this.bill.amount=_.sumBy(this.bill.articles,"price"))})},rollback:function(){this.pause=!0,clearTimeout(this.setTimeout),clearInterval(this.setInterval),this.on_delete=!1,this.counter=1,setTimeout(()=>{this.loading=!1,this.pause=!1},1e3)},toggleInvoice:function(e){this._bill.toggleInvoice(e.id,!e.checked),e.checked=!e.checked},goTo:function(e){this.$router.push(`/articles/view/${e}`)}}},M=()=>{K(e=>({"719760fc":e.color}))},S=A.setup;A.setup=S?(e,t)=>(M(),S(e,t)):M;const X=["id"],Z={class:"swiper-wrapper"},$={class:"swiper-slide"},ee={key:1},te=r("thead",null,[r("tr",null,[r("th",{class:"text-left pr-0"}," Name "),r("th",{class:"text-left px-0"}," Spent "),r("th",{class:"text-left px-0"}," Amount "),r("th",{class:"text-left"})])],-1),le={class:"text-left pr-0"},ie={class:"text-left px-0 text-red"},se={class:"text-left px-0"},ae={class:"text-left px-0"},ne={key:0,class:"bg-blue-lighten-5"},re={class:"mr-1"},oe={class:"d-inline"},de={class:"d-inline text-green"};function ce(e,t,s,b,v,h){const F=o("v-progress-linear"),f=o("v-chip"),k=o("v-icon"),V=o("v-card-text"),Y=o("v-progress-circular"),D=o("v-checkbox"),B=o("v-img"),x=o("v-avatar"),N=o("v-spacer"),j=o("v-badge"),y=o("v-btn"),O=o("v-card-actions"),U=o("v-table"),z=o("v-expand-transition"),q=o("v-list-item"),E=o("v-list"),L=o("v-card");return a(),m("div",{id:s.bill.id,class:"swiper-container"},[r("div",Z,[r("div",$,[n(L,{hover:"",class:J(["mx-auto",{on_delete:e.on_delete}])},{loader:l(()=>[n(F,{active:e.loading_bill,indeterminate:"",height:"3",color:"blue"},null,8,["active"])]),subtitle:l(()=>[d(u(s.bill.date)+" | Created : ",1),h.auth.getAuth.id==s.bill.user_id?(a(),c(f,{key:0,size:"x-small",color:"green"},{default:l(()=>[d("Me")]),_:1})):(a(),c(f,{key:1,size:"x-small",color:"blue"},{default:l(()=>[d(u(s.bill.user.name),1)]),_:1}))]),title:l(()=>[d(" Bill NÂ° : "+u(s.bill.id),1)]),append:l(()=>[e.loading?(a(),m("div",{key:0,class:"cursor-pointer",onClick:t[0]||(t[0]=(...i)=>h.rollback&&h.rollback(...i))},[n(Y,{size:30,width:1,color:"primary",indeterminate:""},{default:l(()=>[e.pause?(a(),c(k,{key:0},{default:l(()=>[d(" mdi-pause ")]),_:1})):(a(),m("span",ee,u(e.counter),1))]),_:1})])):g("",!0),r("div",null,[!e.$route.params.id&&h.auth.getAuth.id==s.bill.user_id?(a(),c(D,{key:0,"model-value":!!s.bill.selected,"hide-details":"",onClick:h.toggleBill,color:"primary"},null,8,["model-value","onClick"])):g("",!0)])]),prepend:l(()=>[n(x,{rounded:"0"},{default:l(()=>[n(B,{alt:"receipt",class:"img_border_radius",src:"/storage/receipt.gif"})]),_:1})]),default:l(()=>[n(V,null,{default:l(()=>[n(k,{color:"green",class:"mx-3 pb-2"},{default:l(()=>[d("mdi-cash-multiple")]),_:1}),r("strong",null,u(s.bill.amount),1),d(" MAD ")]),_:1}),n(N),n(O,{class:"bg-blue-lighten-5"},{default:l(()=>[(a(!0),m(w,null,C(s.bill.invoices,i=>(a(),m("div",{key:i.id,class:"mr-3"},[n(j,{color:i.checked?"green":"yellow",location:"bottom end"},{badge:l(()=>[i.checked?(a(),c(k,{key:0},{default:l(()=>[d("mdi-check")]),_:1})):(a(),c(k,{key:1},{default:l(()=>[d("mdi-close")]),_:1}))]),default:l(()=>[n(x,{size:"20"},{default:l(()=>[n(B,{src:h.user.getUserImage(i.user_id)},null,8,["src"])]),_:2},1024)]),_:2},1032,["color"])]))),128)),n(N),n(y,{class:"mr-2",color:"deep-purple-darken-1",size:"x-small",variant:"tonal",icon:e.expand_invoices?"mdi-chevron-up":"mdi-chevron-down",onClick:t[1]||(t[1]=i=>e.expand_invoices=!e.expand_invoices)},null,8,["icon"]),n(y,{class:"mr-2",color:"blue-darken-1",size:"x-small",variant:"tonal",icon:e.expand_articles?"mdi-chevron-up":"mdi-chevron-down",onClick:t[2]||(t[2]=i=>e.expand_articles=!e.expand_articles)},null,8,["icon"]),e.$route.params.id?g("",!0):(a(),c(y,{key:0,class:"mr-2",color:"green-darken-1",size:"x-small",variant:"tonal",icon:"mdi-text-box",onClick:h.viewBill},null,8,["onClick"]))]),_:1}),n(z,null,{default:l(()=>[e.expand_invoices?(a(),c(U,{key:0},{default:l(()=>[te,r("tbody",null,[(a(!0),m(w,null,C(s.bill.invoices,i=>(a(),m("tr",{key:i.id},[r("td",le,u(i.user.name),1),r("td",ie," -"+u(e.formatFloatNumber(i.spent))+" MAD ",1),r("td",se,[i.price>0?(a(),c(f,{key:0,variant:"tonal",color:"green"},{default:l(()=>[d(u(e.formatFloatNumber(i.price))+" MAD",1)]),_:2},1024)):i.price==0?(a(),c(f,{key:1,variant:"tonal",color:"gray"},{default:l(()=>[d(u(e.formatFloatNumber(i.price))+" MAD",1)]),_:2},1024)):(a(),c(f,{key:2,variant:"tonal",color:"red"},{default:l(()=>[d(u(e.formatFloatNumber(i.price))+" MAD",1)]),_:2},1024))]),r("td",ae,[n(D,{"model-value":!!i.checked,"hide-details":"",onClick:I=>h.toggleInvoice(i),color:"primary",disabled:h.auth.getAuth.id!=i.user_id},null,8,["model-value","onClick","disabled"])])]))),128))])]),_:1})):g("",!0)]),_:1}),n(z,null,{default:l(()=>[e.expand_articles?(a(),m("div",ne,[n(E,{lines:"two",class:"bg-blue-lighten-5"},{default:l(()=>[(a(!0),m(w,null,C(s.bill.articles,i=>(a(),c(q,{key:i.id,onClick:I=>h.goTo(i.id)},{title:l(()=>[r("strong",re,u(i.product.name),1),d(": "),h.auth.getAuth.id==i.user_id?(a(),c(f,{key:0,size:"x-small",color:"green"},{default:l(()=>[d("Me")]),_:1})):(a(),c(f,{key:1,size:"x-small",color:"blue"},{default:l(()=>[d(u(i.user.name),1)]),_:2},1024))]),subtitle:l(()=>[r("div",oe,u(i.date),1),d(" | "),r("strong",de,u(e.formatFloatNumber(i.price))+" MAD ",1)]),prepend:l(()=>[n(x,{rounded:"0"},{default:l(()=>[n(B,{alt:"charges-timeline",class:"img_border_radius",src:"/storage/article.gif"})]),_:1})]),append:l(()=>[s.bill.user_id==h.auth.getAuth.id?(a(),c(y,{key:0,color:"red-lighten-1",icon:"mdi-trash-can",variant:"tonal",size:"x-small",onClick:P(I=>h.unBillArticle(i.id,s.bill.id),["stop"])},null,8,["onClick"])):g("",!0)]),_:2},1032,["onClick"]))),128))]),_:1})])):g("",!0)]),_:1})]),_:1},8,["class"])])])],8,X)}const _e=G(A,[["render",ce]]);export{_e as B,W as u};
