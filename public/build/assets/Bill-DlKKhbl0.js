import{q as L,u as Q,s as p,_ as R,g as G,r as o,o as a,e as f,i as r,a as n,w as l,b as d,t as c,c as u,h as g,F as M,f as S,n as H,p as J,l as K}from"./app-DWVlohUE.js";const P=L("Bill",{state:()=>({date_start:moment().subtract(6,"days").format("YYYY-MM-DD"),date_end:new Date().toISOString().substr(0,10),is_fetch:!1,dashboard:Q()}),actions:{getData:async function(){this.is_fetch==!1&&(this.is_fetch=!0,await p.get("/api/bills",{params:{date_start:this.date_start,date_end:this.date_end}}).then(e=>{this.dashboard.bills=_.sortBy(e.data.bills,"date"),this.is_fetch=!1}))},getBill:async function(e){return await p.get(`/api/bills/${e}`).then(t=>t.data.bill)},deleteBill:async function(e){return p.delete(`/api/bills/${e}`).then(t=>(this.dashboard.bills=this.dashboard.bills.filter(s=>s.id!=e),t))},deleteBills:async function(){let e=this.dashboard.bills.filter(t=>t.selected==!0).map(t=>t.id);return p.post("/api/bills_collect",{bills:e}).then(t=>(this.dashboard.bills=this.dashboard.bills.filter(s=>!e.includes(s.id)),t)).catch(t=>{console.log("error",t)})},toggleBill:function(e){let t=this.dashboard.bills.find(s=>s.id==e);t&&(t.selected=!t.selected)},cancelBill:function(){},toggleInvoice:function(e,t){p.put(`/api/invoices/${e}`,{checked:t})},unBillArticle:async function(e,t){return p.patch(`/api/articles/${e}`,{article:{bill_id:null},update_bill:!0}).then(s=>{let b=this.dashboard.bills.find(v=>v.id==t);return b?(b.articles=b.articles.filter(v=>v.id!=e),b.amount=_.sumBy(b.articles,"price"),!1):!0})}},getters:{getBillQueue:e=>e.dashboard.bills.filter(t=>t.selected===!0),total_bills:e=>_.sumBy(e.dashboard.bills,"amount"),bills:e=>e.dashboard.bills}}),y={props:{bill:Object},data:function(){return{expand_articles:!1,expand_invoices:!1,loading:!1,loading_bill:!1,on_delete:!1,pause:!1,setTimeout:null,setInterval:null,counter:1,color:"white"}},mounted:function(){this.bill.user_id==this.auth.getAuth.id&&this.$nextTick(()=>{const e="#"+this.bill.id,t=new Swiper(e,{resistanceRatio:.85,initialSlide:0,resistance:!0,allowSlideNext:!1,momentumBounce:!0,speed:150});t.on("transitionStart",()=>{this.on_delete=!0,this.loading=!0,this.setTimeout=setTimeout(()=>{this.deleteBill().then(s=>{t.destroy()})},3e3),this.setInterval=setInterval(()=>{++this.counter},1e3)})})},computed:{_bill:function(){return P()},dashboard:function(){return useDashboard()},auth:function(){return G()}},methods:{deleteBill:async function(){return await this._bill.deleteBill(this.bill.id).then(e=>{this.$route.params.id&&this.$router.push({name:"bills.list"})})},aditBill:function(){this.$router.push({name:"bills.update",params:{id:this.bill.id}})},viewBill:function(){this.$router.push({name:"bills.view",params:{id:this.bill.id}})},cancelBill:async function(){return this.loading_bill=!0,await this._bill.cancelBill(this.bill).then(e=>(this.loading_bill=!1,e))},toggleBill:function(){this._bill.toggleBill(this.bill.id)},unBillArticle:async function(e,t){this.loading_bill=!0,await this._bill.unBillArticle(e,t).then(s=>{this.loading_bill=!1,s&&(this.bill.articles=this.bill.articles.filter(b=>b.id!=e),this.bill.amount=_.sumBy(this.bill.articles,"price"))})},rollback:function(){this.pause=!0,clearTimeout(this.setTimeout),clearInterval(this.setInterval),this.on_delete=!1,this.counter=1,setTimeout(()=>{this.loading=!1,this.pause=!1},1e3)},toggleInvoice:function(e){this._bill.toggleInvoice(e.id,!e.checked),e.checked=!e.checked},goTo:function(e){this.$router.push(`/articles/view/${e}`)}}},z=()=>{J(e=>({"788ae93e":e.color}))},I=y.setup;y.setup=I?(e,t)=>(z(),I(e,t)):z;const U=["id"],W={class:"swiper-wrapper"},X={class:"swiper-slide"},Z={key:1},$=r("thead",null,[r("tr",null,[r("th",{class:"text-left pr-0"}," Name "),r("th",{class:"text-left px-0"}," Spent "),r("th",{class:"text-left px-0"}," Amount "),r("th",{class:"text-left"})])],-1),ee={class:"text-left pr-0"},te={class:"text-left px-0 text-red"},le={class:"text-left px-0"},ie={class:"text-left px-0"},se={key:0,class:"bg-blue-lighten-5"},ae={class:"mr-1"},ne={class:"d-inline"},re={class:"d-inline text-green"};function oe(e,t,s,b,v,h){const T=o("v-progress-linear"),m=o("v-chip"),B=o("v-icon"),F=o("v-card-text"),V=o("v-progress-circular"),x=o("v-checkbox"),w=o("v-img"),C=o("v-avatar"),A=o("v-spacer"),k=o("v-btn"),Y=o("v-card-actions"),j=o("v-table"),D=o("v-expand-transition"),O=o("v-list-item"),q=o("v-list"),E=o("v-card");return a(),f("div",{id:s.bill.id,class:"swiper-container"},[r("div",W,[r("div",X,[n(E,{hover:"",class:H(["mx-auto",{on_delete:e.on_delete}])},{loader:l(()=>[n(T,{active:e.loading_bill,indeterminate:"",height:"3",color:"blue"},null,8,["active"])]),subtitle:l(()=>[d(c(s.bill.date)+" | Created : ",1),h.auth.getAuth.id==s.bill.user_id?(a(),u(m,{key:0,size:"x-small",color:"green"},{default:l(()=>[d("Me")]),_:1})):(a(),u(m,{key:1,size:"x-small",color:"blue"},{default:l(()=>[d(c(s.bill.user.name),1)]),_:1}))]),title:l(()=>[d(" Bill NÂ° : "+c(s.bill.id),1)]),append:l(()=>[e.loading?(a(),f("div",{key:0,class:"cursor-pointer",onClick:t[0]||(t[0]=(...i)=>h.rollback&&h.rollback(...i))},[n(V,{size:30,width:1,color:"primary",indeterminate:""},{default:l(()=>[e.pause?(a(),u(B,{key:0},{default:l(()=>[d(" mdi-pause ")]),_:1})):(a(),f("span",Z,c(e.counter),1))]),_:1})])):g("",!0),r("div",null,[!e.$route.params.id&&h.auth.getAuth.id==s.bill.user_id?(a(),u(x,{key:0,"model-value":!!s.bill.selected,"hide-details":"",onClick:h.toggleBill,color:"primary"},null,8,["model-value","onClick"])):g("",!0)])]),prepend:l(()=>[n(C,{rounded:"0"},{default:l(()=>[n(w,{alt:"receipt",class:"img_border_radius",src:"/storage/receipt.gif"})]),_:1})]),default:l(()=>[n(F,null,{default:l(()=>[n(B,{color:"green",class:"mx-3 pb-2"},{default:l(()=>[d("mdi-cash-multiple")]),_:1}),r("strong",null,c(s.bill.amount),1),d(" MAD ")]),_:1}),n(A),n(Y,{class:"bg-blue-lighten-5"},{default:l(()=>[n(A),n(k,{class:"mr-2",color:"deep-purple-darken-1",size:"x-small",variant:"tonal",icon:e.expand_invoices?"mdi-chevron-up":"mdi-chevron-down",onClick:t[1]||(t[1]=i=>e.expand_invoices=!e.expand_invoices)},null,8,["icon"]),n(k,{class:"mr-2",color:"blue-darken-1",size:"x-small",variant:"tonal",icon:e.expand_articles?"mdi-chevron-up":"mdi-chevron-down",onClick:t[2]||(t[2]=i=>e.expand_articles=!e.expand_articles)},null,8,["icon"]),e.$route.params.id?g("",!0):(a(),u(k,{key:0,class:"mr-2",color:"green-darken-1",size:"x-small",variant:"tonal",icon:"mdi-text-box",onClick:h.viewBill},null,8,["onClick"]))]),_:1}),n(D,null,{default:l(()=>[e.expand_invoices?(a(),u(j,{key:0},{default:l(()=>[$,r("tbody",null,[(a(!0),f(M,null,S(s.bill.invoices,i=>(a(),f("tr",{key:i.id},[r("td",ee,c(i.user.name),1),r("td",te," -"+c(e.formatFloatNumber(i.spent))+" MAD ",1),r("td",le,[i.price>0?(a(),u(m,{key:0,variant:"tonal",color:"green"},{default:l(()=>[d(c(e.formatFloatNumber(i.price))+" MAD",1)]),_:2},1024)):i.price==0?(a(),u(m,{key:1,variant:"tonal",color:"gray"},{default:l(()=>[d(c(e.formatFloatNumber(i.price))+" MAD",1)]),_:2},1024)):(a(),u(m,{key:2,variant:"tonal",color:"red"},{default:l(()=>[d(c(e.formatFloatNumber(i.price))+" MAD",1)]),_:2},1024))]),r("td",ie,[n(x,{"model-value":!!i.checked,"hide-details":"",onClick:N=>h.toggleInvoice(i),color:"primary",disabled:h.auth.getAuth.id!=i.user_id},null,8,["model-value","onClick","disabled"])])]))),128))])]),_:1})):g("",!0)]),_:1}),n(D,null,{default:l(()=>[e.expand_articles?(a(),f("div",se,[n(q,{lines:"two",class:"bg-blue-lighten-5"},{default:l(()=>[(a(!0),f(M,null,S(s.bill.articles,i=>(a(),u(O,{key:i.id,onClick:N=>h.goTo(i.id)},{title:l(()=>[r("strong",ae,c(i.product.name),1),d(": "),h.auth.getAuth.id==i.user_id?(a(),u(m,{key:0,size:"x-small",color:"green"},{default:l(()=>[d("Me")]),_:1})):(a(),u(m,{key:1,size:"x-small",color:"blue"},{default:l(()=>[d(c(i.user.name),1)]),_:2},1024))]),subtitle:l(()=>[r("div",ne,c(i.date),1),d(" | "),r("strong",re,c(e.formatFloatNumber(i.price))+" MAD ",1)]),prepend:l(()=>[n(C,{rounded:"0"},{default:l(()=>[n(w,{alt:"charges-timeline",class:"img_border_radius",src:"/storage/article.gif"})]),_:1})]),append:l(()=>[s.bill.user_id==h.auth.getAuth.id?(a(),u(k,{key:0,color:"red-lighten-1",icon:"mdi-trash-can",variant:"tonal",size:"x-small",onClick:K(N=>h.unBillArticle(i.id,s.bill.id),["stop"])},null,8,["onClick"])):g("",!0)]),_:2},1032,["onClick"]))),128))]),_:1})])):g("",!0)]),_:1})]),_:1},8,["class"])])])],8,U)}const ce=R(y,[["render",oe]]);export{ce as B,P as u};
