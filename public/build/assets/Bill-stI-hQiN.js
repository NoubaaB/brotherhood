import{q as L,u as Q,s as f,_ as R,g as G,r as o,o as a,e as m,i as r,a as n,w as l,b as u,t as d,c as h,h as p,F as S,f as I,n as H,p as J,l as K}from"./app-CaUE95Aj.js";const P=L("Bill",{state:()=>({date_start:moment().subtract(6,"days").format("YYYY-MM-DD"),date_end:new Date().toISOString().substr(0,10),is_fetch:!1,dashboard:Q()}),actions:{getData:async function(){this.is_fetch==!1&&(this.is_fetch=!0,await f.get("/api/bills",{params:{date_start:this.date_start,date_end:this.date_end}}).then(e=>{this.dashboard.bills=_.sortBy(e.data.bills,"date"),this.is_fetch=!1}))},getBill:async function(e){return await f.get(`/api/bills/${e}`).then(t=>t.data.bill)},deleteBill:async function(e){return f.delete(`/api/bills/${e}`).then(t=>(this.dashboard.bills=this.dashboard.bills.filter(i=>i.id!=e),t))},deleteBills:async function(){let e=this.dashboard.bills.filter(t=>t.selected==!0).map(t=>t.id);return f.post("/api/bills_collect",{bills:e}).then(t=>(this.dashboard.bills=this.dashboard.bills.filter(i=>!e.includes(i.id)),t)).catch(t=>{console.log("error",t)})},toggleBill:function(e){let t=this.dashboard.bills.find(i=>i.id==e);t&&(t.selected=!t.selected)},cancelBill:function(){},toggleInvoice:function(e,t){f.put(`/api/invoices/${e}`,{checked:t})},unBillArticle:async function(e,t){return f.patch(`/api/articles/${e}`,{article:{bill_id:null},update_bill:!0}).then(i=>{let b=this.dashboard.bills.find(v=>v.id==t);return b?(b.articles=b.articles.filter(v=>v.id!=e),b.amount=_.sumBy(b.articles,"price"),!1):!0})}},getters:{getBillQueue:e=>e.dashboard.bills.filter(t=>t.selected===!0),total_bills:e=>_.sumBy(e.dashboard.bills,"amount"),bills:e=>e.dashboard.bills}}),y={props:{bill:Object},data:function(){return{expand_articles:!1,expand_invoices:!1,loading:!1,loading_bill:!1,on_delete:!1,pause:!1,setTimeout:null,setInterval:null,counter:1,color:"white"}},mounted:function(){this.bill.user_id==this.auth.getAuth.id&&this.$nextTick(()=>{const e="#"+this.bill.id,t=new Swiper(e,{resistanceRatio:.85,initialSlide:0,resistance:!0,allowSlideNext:!1,momentumBounce:!0,speed:150});t.on("transitionStart",()=>{this.on_delete=!0,this.loading=!0,this.setTimeout=setTimeout(()=>{this.deleteBill().then(i=>{t.destroy()})},3e3),this.setInterval=setInterval(()=>{++this.counter},1e3)})})},computed:{_bill:function(){return P()},dashboard:function(){return useDashboard()},auth:function(){return G()}},methods:{deleteBill:async function(){return await this._bill.deleteBill(this.bill.id).then(e=>{this.$route.params.id&&this.$router.push({name:"bills.list"})})},aditBill:function(){this.$router.push({name:"bills.update",params:{id:this.bill.id}})},viewBill:function(){this.$router.push({name:"bills.view",params:{id:this.bill.id}})},cancelBill:async function(){return this.loading_bill=!0,await this._bill.cancelBill(this.bill).then(e=>(this.loading_bill=!1,e))},toggleBill:function(){this._bill.toggleBill(this.bill.id)},unBillArticle:async function(e,t){this.loading_bill=!0,await this._bill.unBillArticle(e,t).then(i=>{this.loading_bill=!1,i&&(this.bill.articles=this.bill.articles.filter(b=>b.id!=e),this.bill.amount=_.sumBy(this.bill.articles,"price"))})},rollback:function(){this.pause=!0,clearTimeout(this.setTimeout),clearInterval(this.setInterval),this.on_delete=!1,this.counter=1,setTimeout(()=>{this.loading=!1,this.pause=!1},1e3)},toggleInvoice:function(e){this._bill.toggleInvoice(e.id,!e.checked),e.checked=!e.checked},goTo:function(e){this.$router.push(`/articles/view/${e}`)}}},M=()=>{J(e=>({"2e134980":e.color}))},T=y.setup;y.setup=T?(e,t)=>(M(),T(e,t)):M;const U=["id"],W={class:"swiper-wrapper"},X={class:"swiper-slide"},Z={key:1},$=r("thead",null,[r("tr",null,[r("th",{class:"text-left pr-0"}," Name "),r("th",{class:"text-left px-0"}," Spent "),r("th",{class:"text-left px-0"}," Amount "),r("th",{class:"text-left"})])],-1),ee={class:"text-left pr-0"},te={class:"text-left px-0 text-red"},le={class:"text-left px-0"},ie={class:"text-left px-0"},se={key:0,class:"bg-blue-lighten-5"},ae={class:"d-inline"},ne={class:"d-inline text-green"};function re(e,t,i,b,v,c){const z=o("v-progress-linear"),g=o("v-chip"),B=o("v-icon"),F=o("v-card-text"),V=o("v-progress-circular"),x=o("v-checkbox"),w=o("v-img"),C=o("v-avatar"),A=o("v-spacer"),k=o("v-btn"),Y=o("v-card-actions"),j=o("v-table"),D=o("v-expand-transition"),O=o("v-list-item"),q=o("v-list"),E=o("v-card");return a(),m("div",{id:i.bill.id,class:"swiper-container"},[r("div",W,[r("div",X,[n(E,{hover:"",class:H(["mx-auto",{on_delete:e.on_delete}])},{loader:l(()=>[n(z,{active:e.loading_bill,indeterminate:"",height:"3",color:"blue"},null,8,["active"])]),subtitle:l(()=>[u(d(i.bill.date)+" | Created : ",1),c.auth.getAuth.id==i.bill.user_id?(a(),h(g,{key:0,size:"x-small",color:"green"},{default:l(()=>[u("Me")]),_:1})):(a(),h(g,{key:1,size:"x-small",color:"blue"},{default:l(()=>[u(d(i.bill.user.name),1)]),_:1}))]),title:l(()=>[u(" Bill NÂ° : "+d(i.bill.id),1)]),append:l(()=>[e.loading?(a(),m("div",{key:0,class:"cursor-pointer",onClick:t[0]||(t[0]=(...s)=>c.rollback&&c.rollback(...s))},[n(V,{size:30,width:1,color:"primary",indeterminate:""},{default:l(()=>[e.pause?(a(),h(B,{key:0},{default:l(()=>[u(" mdi-pause ")]),_:1})):(a(),m("span",Z,d(e.counter),1))]),_:1})])):p("",!0),r("div",null,[!e.$route.params.id&&c.auth.getAuth.id==i.bill.user_id?(a(),h(x,{key:0,"model-value":!!i.bill.selected,"hide-details":"",onClick:c.toggleBill,color:"primary"},null,8,["model-value","onClick"])):p("",!0)])]),prepend:l(()=>[n(C,{rounded:"0"},{default:l(()=>[n(w,{alt:"receipt",class:"img_border_radius",src:"/storage/receipt.gif"})]),_:1})]),default:l(()=>[n(F,null,{default:l(()=>[n(B,{color:"green",class:"mx-3 pb-2"},{default:l(()=>[u("mdi-cash-multiple")]),_:1}),r("strong",null,d(i.bill.amount),1),u(" MAD ")]),_:1}),n(A),n(Y,{class:"bg-blue-lighten-5"},{default:l(()=>[n(A),n(k,{class:"mr-2",color:"deep-purple-darken-1",size:"x-small",variant:"tonal",icon:e.expand_invoices?"mdi-chevron-up":"mdi-chevron-down",onClick:t[1]||(t[1]=s=>e.expand_invoices=!e.expand_invoices)},null,8,["icon"]),n(k,{class:"mr-2",color:"blue-darken-1",size:"x-small",variant:"tonal",icon:e.expand_articles?"mdi-chevron-up":"mdi-chevron-down",onClick:t[2]||(t[2]=s=>e.expand_articles=!e.expand_articles)},null,8,["icon"]),e.$route.params.id?p("",!0):(a(),h(k,{key:0,class:"mr-2",color:"green-darken-1",size:"x-small",variant:"tonal",icon:"mdi-text-box",onClick:c.viewBill},null,8,["onClick"]))]),_:1}),n(D,null,{default:l(()=>[e.expand_invoices?(a(),h(j,{key:0},{default:l(()=>[$,r("tbody",null,[(a(!0),m(S,null,I(i.bill.invoices,s=>(a(),m("tr",{key:s.id},[r("td",ee,d(s.user.name),1),r("td",te," -"+d(e.formatFloatNumber(s.spent))+" MAD ",1),r("td",le,[s.price>0?(a(),h(g,{key:0,variant:"tonal",color:"green"},{default:l(()=>[u(d(e.formatFloatNumber(s.price))+" MAD",1)]),_:2},1024)):s.price==0?(a(),h(g,{key:1,variant:"tonal",color:"gray"},{default:l(()=>[u(d(e.formatFloatNumber(s.price))+" MAD",1)]),_:2},1024)):(a(),h(g,{key:2,variant:"tonal",color:"red"},{default:l(()=>[u(d(e.formatFloatNumber(s.price))+" MAD",1)]),_:2},1024))]),r("td",ie,[n(x,{"model-value":!!s.checked,"hide-details":"",onClick:N=>c.toggleInvoice(s),color:"primary",disabled:c.auth.getAuth.id!=s.user_id},null,8,["model-value","onClick","disabled"])])]))),128))])]),_:1})):p("",!0)]),_:1}),n(D,null,{default:l(()=>[e.expand_articles?(a(),m("div",se,[n(q,{lines:"two",class:"bg-blue-lighten-5"},{default:l(()=>[(a(!0),m(S,null,I(i.bill.articles,s=>(a(),h(O,{key:s.id,onClick:N=>c.goTo(s.id)},{title:l(()=>[r("strong",null,d(s.product.name),1)]),subtitle:l(()=>[r("div",ae,d(s.date),1),u(" | "),r("strong",ne,d(e.formatFloatNumber(s.price))+" MAD ",1)]),prepend:l(()=>[n(C,{rounded:"0"},{default:l(()=>[n(w,{alt:"charges-timeline",class:"img_border_radius",src:"/storage/article.gif"})]),_:1})]),append:l(()=>[i.bill.user_id==c.auth.getAuth.id?(a(),h(k,{key:0,color:"red-lighten-1",icon:"mdi-trash-can",variant:"tonal",size:"x-small",onClick:K(N=>c.unBillArticle(s.id,i.bill.id),["stop"])},null,8,["onClick"])):p("",!0)]),_:2},1032,["onClick"]))),128))]),_:1})])):p("",!0)]),_:1})]),_:1},8,["class"])])])],8,U)}const de=R(y,[["render",re]]);export{de as B,P as u};
